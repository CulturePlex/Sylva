{% extends "base.html" %}
{% load i18n graphs graph_filters data_filters compress %}

{% block navigation_buttons %}
  {{ block.super }}
{% endblock %}

{% block title %}
  {{ graph.name }}
{% endblock %}

{% block extra_links %}
  {% compress css %}
    <link rel="stylesheet" href="{{ STATIC_PREFIX }}visualsearch/visualsearch-modified.css">
    <link rel="stylesheet" href="{{ STATIC_PREFIX }}visualsearch/visualsearch-datauri-modified.css">
  {% endcompress %}
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script type="text/javascript">
    sylva.urls = {
      nodesLookupFull: "{% url "nodes_lookup_full" graph.slug %}",
      nodesEdit: '{% url "nodes_edit" graph.slug 0 %}',
      nodesView: '{% url "nodes_view" graph.slug 0 %}',
      nodeRelationships: '{% url "node_relationships" graph.slug 0 %}'
    };
    sylva.jsValues = {
      facets: JSON.parse('{{ property_keys|escapejs }}'),
      facetValues: JSON.parse('{{ property_values|escapejs }}'),
      nodetypeId: {{ node_type.id }}
    };
  </script>

  {% compress js %}
    <script type="text/javascript" src="{{ STATIC_PREFIX }}js/jquery-ui-1.10.4.js"></script>
    <script type="text/javascript" src="{{ STATIC_PREFIX }}visualsearch/vendor/underscore-1.4.3.js"></script>
    <script type="text/javascript" src="{{ STATIC_PREFIX }}visualsearch/vendor/backbone-0.9.10.js"></script>
    <script type="text/javascript" src="{{ STATIC_PREFIX }}visualsearch/visualsearch-modified.js"></script>
    <script type="text/javascript" src="{{ STATIC_PREFIX }}data/js/node_list.js"></script>
  {% endcompress %}
{% endblock %}

{% block menu_buttons %}
  {% toolbar on="nodes" %}
{% endblock %}

{% block content_title %}
  {% breadcrumb graph graph.data node_type %}
{% endblock %}

{% block content %}
  <div id="content2">
    {% if nodes %}
      <div id="search-query" class="visual-search"></div>
      <div class="show-hide-button" style="float: right;">
        <a href="#">{% trans "Hide & show property" %}: </a>
        <ul class="dropdown">
          {% for prop in properties %}
            <li><i class="fa fa-eye" id="show-hide-{{prop.slug}}"></i><a style="font-size:11px; margin-left: 5%;" href='javascript:void(0);' data-key="{{prop.slug}}" class="show-hide">{{prop.key}}</a></li>
          {% endfor %}
        </ul>
      </div>
      <table id="content_table" class="content-table text-left">
        <thead>
          <tr>
            <th>{% trans "#" %}</th>
            {% for prop in properties %}
                <th class="{{ prop.slug }}"><a href="?order_by={{ prop.key }}&dir={{ dir }}" id="{{prop.slug}}"><p class="shorten-text">{{ prop.key }} <a class='remove-sorting' href="?order_by=default" title="{% trans "Remove from sorting" %}" /></a>
                  {% if dir == 'desc' %}
                    <a class='sorting-asc' href="?order_by={{ prop.key }}&dir={{ dir }}" title="{% trans "Sorting ascending by" %} {{ order_by }}" />
                  {% else %}
                    <a class='sorting-desc' href="?order_by={{ prop.key }}&dir={{ dir }}" title="{% trans "Sorting descending by " %} {{ order_by }}" />
                  {% endif %}
                </p></a></th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for node in nodes %}
            <tr class="{% cycle 'row-even' 'row-odd' %}">
              <td class="dataList">
                <a href="javascript:void(0)" data-node="{{ node.id }}" class="rels" alt="{% trans "Toggle relationships" %}" title="{% trans "Toggle relationships" %}">&nbsp;</a>
                <a href="{% url "nodes_edit" graph.slug node.id %}" class="edit" alt="{% trans "Edit node" %}" title="{% trans "Edit node" %}"><!-- {{ node.id }}  -->&nbsp;</a>
              </td>
              {% for prop in properties %}
                {% if node|get:prop.key == 'True' %}
                  <td class="{{ prop.slug }} shorten-text"><a class="type-list-true" href="{% url "nodes_view" graph.slug node.id %}" title="{% trans "View node" %}">{{ node|get:prop.key|default:none_label }}</a></td>
                {% elif node|get:prop.key == 'False' %}
                  <td class="{{ prop.slug }} shorten-text"><a class="type-list-false" href="{% url "nodes_view" graph.slug node.id %}" title="{% trans "View node" %}">{{ node|get:prop.key|default:none_label }}</a></td>
                {% else %}
                  <td class="{{ prop.slug }}"><p class="shorten-text"><a href="{% url "nodes_view" graph.slug node.id %}" title="{% trans "View node" %}">{{ node|get:prop.key|default:none_label }}</a></p></td>
                {% endif %}
              {% endfor %}
            </tr>
            <tr class="{% cycle 'row-even' 'row-odd' %}">
              <td colspan="{{ properties_count }}" id="td{{ node.id }}" class="hidden retrieve-relationships" data-node="{{ node.id }}" data-display="{{ node.display }}" data-node-rels="{% url "node_relationships" graph.slug node.id %}">
                <span class="helptext">{% trans "Loading" %}...</span>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
        <p>{% trans "There are no data added to this type yet." %}</p>
        <a class="button" href="{% url "nodes_create" graph.slug node_type.id %}">{% trans "Add data" %}</a>
    {% endif %}
    {% if graph.data.total_nodes == 0 and graph.data.total_relationships == 0 and graph.relaxed %}
      <a class="button" href="{% url "tool_import" graph.slug %}">{% trans "Import" %}</a>
      <span class="buttonLinkOption">
        {% trans "Import a graph in GEXF format, or nodes and relationships in CSV format." %}
      </span>
    {% else %}
      <div class="pagination">
        {% if nodes.paginator.per_page < nodes.paginator.count %}
          <span class='pagination-info'>
            {% blocktrans with per_page=nodes.paginator.per_page count=nodes.paginator.count name=node_type.name %}
              Showing {{ per_page }} of {{ count }} {{ name }}.
            {% endblocktrans %}
          </span>
          <span class="step-links">
            {% if nodes.has_previous %}
              <a href="?page={{ nodes.previous_page_number }}"><span class="symbol-medium">←</span></a>
            {% endif %}

            <span class="current">
              {% blocktrans with number=nodes.number num_pages=nodes.paginator.num_pages %}
                Page {{ number }} of {{ num_pages }}.
              {% endblocktrans %}
            </span>

            {% if nodes.has_next %}
              <a href="?page={{ nodes.next_page_number }}"><span class="symbol-medium">→</span></a>
            {% endif %}
          </span>
        {% elif nodes %}
          <span class="pagination-info">
            {% blocktrans with count=nodes.paginator.count name=node_type.name %}
              Showing {{ count }} elements {{ name }}.
            {% endblocktrans %}
          </span>
        {% endif %}
      </div>
    {% endif %}
  </div>
{% endblock %}
