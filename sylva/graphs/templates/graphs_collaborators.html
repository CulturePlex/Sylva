{% extends "base.html" %}
{% load i18n %}

{% block navigation_buttons %}
{{ block.super }}
{% endblock %}

{% block title %}
{{ graph.name }}
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="{{ STATIC_PREFIX }}js/chosen.jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_PREFIX }}css/chosen.css" />
<script type="text/javascript">
    function refreshPermissions() {
        var permissionsDiv = document.getElementById("user_permissions");
        user = document.getElementById('user_sel').value;
        permissionsDiv.style.display = "none";
        checks = $('.perm_chk');
        for(i=0;i<checks.length;i++) {
            checks[i].checked = false;
        }
        if (user!="") {
            $.ajax({url:"{% url user_permissions graph.id %}",
                    data: {user_id: user},
                    success: function(user_permissions) {
                        perms = JSON.parse(user_permissions);
                        for(var i in perms) {
                            if (perms[i]) {
                                chk = document.getElementById("perm_"+i);
                                chk.checked = true;
                            }
                        }
                    }
            });
            permissionsDiv.style.display = "block";
       }
    }
</script>
{% endblock %}
   
{% block body_attrs %}
onload="$('.chzn-select').chosen();"
{% endblock %}


{% block menu_buttons %}
<li><a href="{% url graph_view graph.id %}" class="link"><span>{% trans "Graph" %}</span></a></li>
<li><a href="{% url nodes_list graph.id %}" class="link"><span>{% trans "Nodes" %}</span></a></li>
<li><a href="{% url relationships_list graph.id %}" class="link"><span>{% trans "Relationships" %}</span></a></li>
<li><a href="{% url schema_edit graph.id %}" class="link"><span>{% trans "Schema" %}</span></a></li>
<li><a href="{% url graph_collaborators graph.id %}" class="text"><span>{% trans "Collaborators" %}</span></a></li>
{% endblock %}

{% block content_title %}
<h2>{% trans "Graphs" %} » {{ graph.name|truncatewords_html:8 }} » {% trans "Collaborators" %}</h2>
{% endblock %}

{% block content %}
<div id="content2">
    <div class="content2-first">
        <p>Graph owner: <a href="#">{{ graph.owner }}</a></p>
        <hr/>
        <p>Current collaborators:</p>
        <ul>
            <li><a href="#">{{ graph.owner }}</a></li>
            {% for c in collaborators %}
            <li><a href="#">{{ c.username }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <div class="content-divider"></div>
    <div class="content2-second">
        <p>Select an user to edit as a collaborator:</p>
        <select id="user_sel" class="chzn-select" name="user_id" 
            onChange="refreshPermissions();">
            <option value=""></option> 
            {% for u in users %}
                <option value="{{ u.id }}">{{ u.username }}</option>
            {% endfor %}
            </select>
            <div id="permissions">
                <p>Permissions:</p>
                <div id="user_permissions" style="display:none">
                {% for p in permissions %}
                <input id="perm_{{ p.id }}" class="perm_chk" type="checkbox">
                    <span>{{ p.name }}</span><br/>
                {% endfor %}
                </div>
            </div>
    </div>
</div>
{% endblock %}
