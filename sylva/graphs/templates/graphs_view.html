{% extends "base.html" %}
{% load i18n graphs %}

{% block navigation_buttons %}
{{ block.super }}
{% endblock %}

{% block title %}
{{ graph.name }}
{% endblock %}

{% block menu_buttons %}
{% toolbar on="graph" %}
{% endblock %}

{% block content_title %}
  {% if node %}
    {% breadcrumb graph node.display %}
  {% else %}
    {% breadcrumb graph %}
  {% endif %}
{% endblock %}

{% block content %}
<div id="canvas-container">
  <div id="canvas-info">
    <div id="element-info">
      {% trans "Click any node to interact" %}
    </div>
    <div id="node-type-legend">
    </div>
  </div>
  <div class="graph-controls">
    <div class="sigma-checkbox" style="display:none;">
      <a id="sigma-zoom-in" class="button icon-plus zoom zoom-left" style="font-size:100%;" title="{% trans "Zoom in" %}"></a>
    </div>
    <div class="sigma-checkbox" style="display:none;">
      <a id="sigma-zoom-out" class="button icon-minus zoom zoom-right" style="font-size:100%;" title="{% trans "Zoom out" %}"></a>
    </div>
    <div class="sigma-checkbox" style="display:none;">
      <input type="checkbox" id="sigma-node-info">
      <label for="sigma-node-info" title="{% trans "Show node info" %}">{% trans "Node info" %}</label>
    </div>
    <div class="sigma-checkbox" style="display:none;">
      <input type="checkbox" id="sigma-hidden-layout">
      <label for="sigma-hidden-layout" title="{% trans "Consider the hidden nodes to the layout" %}">{% trans "Hidden nodes layout" %}</label>
    </div>
    <select id="sigma-graph-layout" style="display:none;">
      <option id="label" disabled selected>{% trans "Graph layout" %}</option>
      <option id="force-atlas-2">{% trans "Force Atlas 2" %}</option>
      <option id="grid">{% trans "Grid" %}</option>
      <option id="circular">{% trans "Circular" %}</option>
    </select>
    <select id="sigma-node-size" style="display:none;">
      <option id="label" disabled selected>{% trans "Node size" %}</option>
      <option id="same">{% trans "Same for all" %}</option>
      <option id="total-degree">{% trans "Total degree" %}</option>
      <option id="in-degree">{% trans "In degree" %}</option>
      <option id="out-degree">{% trans "Out degree" %}</option>
    </select>
    <select id="sigma-edge-shape" style="display:none;">
      <option id="label" disabled selected>{% trans "Edge shape" %}</option>
      <option id="straight">{% trans "Straight" %}</option>
      <option id="arrow">{% trans "Arrow" %}</option>
      <option id="curve">{% trans "Curve" %}</option>
    </select>
    <div class="sigma-checkbox" style="display:none; float:right;">
      <a id="sigma-go-fullscreen" class="button" style="font-size:100%;" title="{% trans "Fullscreen" %}">{% trans "Fullscreen" %}</a>
    </div>
    <div class="sigma-checkbox" style="display:none; float:right;">
      <a id="sigma-export-image" class="button" style="font-size:100%;" title="{% trans "Save as a PNG image" %}" download="{{ graph.slug }}.png">{% trans "Save as image" %}</a>
    </div>
  </div>
  <div id="sigma-wrapper">
    <div id="sigma-container"></div>
  </div>
  <span id="sigma-pause" class="pause" style="display:none;" data-state="running">{% trans "Pause" %}</span>
  <div id="canvas-box">
    <div id="spinner"></div>
    <canvas id="graph-support">{% trans "Your browser does not support graph visualization" %}</canvas>
  </div>
</div>

  <!-- Start of DOM elements working as memory system and debugging -->
<div id="sec-debug" style="display:none;">
  <div id="sec-node-list">
    <ul id="node-list"></ul>
  </div>
  <div id="sec-edge-list">
    <ol id="edge-list"></ol>
  </div>

  <h3>Graph Nodes Debug</h3>
  <textarea id="id_graph_nodes" rows="10" cols="80" name="graph_nodes">{}</textarea>
  <h3>Graph Edges Debug</h3>
  <textarea id="id_graph_edges" rows="10" cols="80" name="graph_edges">[]</textarea>
  <h3>Graph Schema Debug</h3>
  <textarea id="id_graph_schema" rows="10" cols="80" name="graph_schema">{}</textarea>
</div>
<!-- End of DOM elements working as memory system and debugging -->

<br/>
<div>
    <div class="not-available">
    </div>
</div>
{% graph_info graph "show_edit" %}

<!-- Features Tour -->
<ol id="tour" class="hidden" data-tour-id="graphs-view">
  <li data-id="visualization-type" data-button="{% trans "Next" %}">
    <h2>{% trans "Visualization" %}</h2>
    <p>{% trans "You can choose from two different views in order to visualize the graph:" %}
      <dl>
        <dt>{% trans "Inspect graph" %}</dt>
        <dd>{% trans "Choose this view to visualize small graphs in detail." %}</dd>
        <dt>{% trans "Whole graph" %}</dt>
        <dd>{% trans "This is the recommended view to visualize big/medium graphs (those with more than 50 nodes)." %}</dd>
      </dl>
    </p>
  </li>
  <li data-id="canvas-info" data-button="{% trans "Next" %}" data-options="tipLocation:right">
    <h2>{% trans "Node info" %}</h2>
    <p>{% trans "Clicking on a node, you will show some useful information inside this panel:" %}
      <dl>
        <dt>{% trans "A color legend" %}</dt>
        <dd>{% trans "Useful to identify the different types of node from the graph." %}</dd>
        <dt>{% trans "View related nodes" %}</dt>
        <dd>{% trans "Clicking on this link, you will show a partial graph with just the related nodes to the one selected." %}</dd>
        <dt>{% trans "View node data" %}</dt>
        <dd>{% trans "Show details for the selected node." %}</dd>
        <dt>{% trans "Edit node data" %}</dt>
        <dd>{% trans "Edit details for the selected node." %}</dd>
      </dl>
    </p>
  </li>
  <li data-class="graph-title" data-button="{% trans "Finish" %}" data-options="nubPosition:right" class="joyride-position-graph-pause">
    <h2>{% trans "Pause" %}</h2>
    <p>{% trans "You can use this button to pause/run the rendering of the graph." %}</p>
  </li>
</ol>

{% endblock content %}

{% block extra_scripts %}
<script type="text/javascript">
  sylva.nodeViewURL = "{% url "nodes_view" graph.slug 0 %}";
  sylva.nodeEditURL = "{% url "nodes_edit" graph.slug 0 %}";
  sylva.graphViewURL = "{% url "graph_view" graph.slug %}";
  sylva.is_graph_empty = {{ is_graph_empty|slugify }};
  sylva.is_schema_empty = {{ is_schema_empty|slugify }};
  sylva.view_graph_ajax_url = "{{ view_graph_ajax_url }}";
  sylva.edit_nodetype_color_ajax_url = "{{ edit_nodetype_color_ajax_url }}";
</script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/sigma.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.layout.forceAtlas2.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.parsers.gexf.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.parsers.json.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.plugins.animate.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.plugins.dragNodes.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.plugins.neighborhoods.min.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma/plugins/sigma.renderers.customShapes.min.js"></script>

<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/colpick/colpick.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/colpick/rgbcolor.js"></script>

<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/visualization-utils.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/sigma-visualization.js"></script>
<script type="text/javascript" src="{{ STATIC_PREFIX }}graphs/js/visualizations.js"></script>

<link type="text/css" rel="stylesheet" href="{{ STATIC_PREFIX }}graphs/css/colpick/colpick.css" />
<link type="text/css" rel="stylesheet" href="{{ STATIC_PREFIX }}graphs/css/colpick/colpick.mod.css" />
{% endblock %}
